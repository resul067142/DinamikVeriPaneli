{% extends 'base.html' %}
{% load custom_filters %}

{% block title %}Ana Sayfa - DVP{% endblock %}

{% block content %}
<div class="space-y-4">
    <!-- Compact Header with Countdown -->
    <div class="card p-3 bg-gradient-to-r from-blue-50 to-indigo-50 border border-blue-200">
        <div class="flex flex-col lg:flex-row items-center justify-between gap-4">
            <div class="text-center lg:text-left">
                <h1 class="text-lg font-bold text-gray-800 mb-1">📊 CİHAZ DURUM TABLOSU</h1>
                <p class="text-xs text-gray-600">Türkiye'nin 81 ilinin verilerini yönetin</p>
            </div>
            
            <!-- Compact Countdown -->
            <div class="bg-white rounded-lg border border-blue-200 p-2">
                <h3 class="text-xs font-semibold text-blue-800 mb-1 text-center">⏰ Proje Bitiş Süresi</h3>
                <div id="countdown" class="grid grid-cols-4 gap-1 text-center">
                    <div class="bg-blue-100 rounded p-1">
                        <div class="text-base font-bold text-blue-600" id="months">0</div>
                        <div class="text-xs text-blue-800">Ay</div>
                    </div>
                    <div class="bg-green-100 rounded p-1">
                        <div class="text-base font-bold text-green-600" id="days">0</div>
                        <div class="text-xs text-green-800">Gün</div>
                    </div>
                    <div class="bg-orange-100 rounded p-1">
                        <div class="text-base font-bold text-orange-600" id="hours">0</div>
                        <div class="text-xs text-orange-800">Saat</div>
                    </div>
                    <div class="bg-red-100 rounded p-1">
                        <div class="text-base font-bold text-red-600" id="seconds">0</div>
                        <div class="text-xs text-red-800">Sn</div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Quick Stats Grid -->
    <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-2">
        <!-- User Info -->
        <div class="card p-2 text-center bg-gradient-to-br from-purple-50 to-indigo-50 border border-purple-200">
            {% if user.is_superuser %}
                <div class="inline-block bg-purple-100 text-purple-800 px-2 py-1 rounded-full text-xs font-medium mb-1 border border-purple-300">
                    👑 Admin
                </div>
            {% else %}
                <div class="inline-block bg-blue-100 text-blue-800 px-2 py-1 rounded-full text-xs font-medium mb-1 border border-blue-300">
                    👤 İl Sorumlusu
                </div>
            {% endif %}
            <h3 class="text-xs font-bold text-gray-800">{{ user.username }}</h3>
            <p class="text-xs text-gray-600">{{ user.email|default:"E-posta yok" }}</p>
        </div>

        <!-- Total Data -->
        <div class="card p-2 text-center bg-gradient-to-br from-blue-50 to-cyan-50 border border-blue-200">
            <div class="text-xl font-bold text-blue-600 mb-1">{{ veriler.count|default:"0" }}</div>
            <div class="text-xs text-blue-800 font-medium">Toplam Veri</div>
            <div class="w-full bg-blue-200 rounded-full h-1 mt-2">
                <div class="bg-blue-600 h-1 rounded-full" style="width: {% widthratio veriler.count|default:0 100 1 %}%"></div>
            </div>
        </div>

        <!-- Total Users -->
        <div class="card p-2 text-center bg-gradient-to-br from-green-50 to-emerald-50 border border-green-200">
            <div class="text-xl font-bold text-green-600 mb-1">{{ user_count|default:"0" }}</div>
            <div class="text-xs text-green-800 font-medium">Toplam Kullanıcı</div>
            <div class="w-full bg-green-200 rounded-full h-1 mt-2">
                <div class="bg-green-600 h-1 rounded-full" style="width: {% widthratio user_count|default:0 100 1 %}%"></div>
            </div>
        </div>

        <!-- Active Columns -->
        <div class="card p-2 text-center bg-gradient-to-br from-orange-50 to-amber-50 border border-orange-200">
            <div class="text-xl font-bold text-orange-600 mb-1">{{ aktif_sutunlar.count|default:"0" }}</div>
            <div class="text-xs text-orange-800 font-medium">Aktif Sütun</div>
            <div class="w-full bg-orange-200 rounded-full h-1 mt-2">
                <div class="bg-orange-600 h-1 rounded-full" style="width: {% widthratio aktif_sutunlar.count|default:0 100 1 %}%"></div>
            </div>
        </div>
    </div>

    <!-- Yönetim ve Destek Kartları -->
    <div class="card p-3 bg-gradient-to-r from-gray-50 to-blue-50 border border-gray-200">
        <h3 class="text-base font-semibold text-gray-800 mb-3 text-center">👥 Yönetim ve Destek Ekibi</h3>
        <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-3">
            <!-- Yönetici Kartı -->
            <div class="bg-white rounded-lg shadow-md border border-gray-200 overflow-hidden hover:shadow-lg transition-all duration-300 hover:scale-105" data-role="yonetici">
                <div class="p-3 text-center">
                    <div class="w-12 h-12 mx-auto mb-2 bg-gradient-to-br from-blue-500 to-blue-600 rounded-full flex items-center justify-center">
                        <img src="https://via.placeholder.com/48x48/3b82f6/ffffff?text=👔" alt="Yönetici" class="w-10 h-10 rounded-full">
                    </div>
                    <h4 class="text-sm font-bold text-gray-800 mb-1">Yönetici</h4>
                    <p class="text-xs text-gray-600 mb-2">Genel Koordinasyon</p>
                    <div class="flex items-center justify-center space-x-2 text-xs text-gray-500">
                        <span>📧 yonetici@dvp.com</span>
                    </div>
                    <div class="mt-3">
                        <button onclick="editTeamMember('yonetici')" class="px-2 py-1 bg-blue-100 hover:bg-blue-200 text-blue-700 text-xs rounded-full transition-colors">
                            ✏️ Düzenle
                        </button>
                    </div>
                </div>
            </div>

            <!-- Yazılım Kartı -->
            <div class="bg-white rounded-lg shadow-md border border-gray-200 overflow-hidden hover:shadow-lg transition-all duration-300 hover:scale-105" data-role="yazilim">
                <div class="p-3 text-center">
                    <div class="w-12 h-12 mx-auto mb-2 bg-gradient-to-br from-green-500 to-green-600 rounded-full flex items-center justify-center">
                        <img src="https://via.placeholder.com/48x48/10b981/ffffff?text=💻" alt="Yazılım" class="w-10 h-10 rounded-full">
                    </div>
                    <h4 class="text-sm font-bold text-gray-800 mb-1">Yazılım</h4>
                    <p class="text-xs text-gray-600 mb-2">Geliştirme & Bakım</p>
                    <div class="flex items-center justify-center space-x-2 text-xs text-gray-500">
                        <span>📧 yazilim@dvp.com</span>
                    </div>
                    <div class="mt-3">
                        <button onclick="editTeamMember('yazilim')" class="px-2 py-1 bg-green-100 hover:bg-green-200 text-green-700 text-xs rounded-full transition-colors">
                            ✏️ Düzenle
                        </button>
                    </div>
                </div>
            </div>

            <!-- Teknik Destek Kartı -->
            <div class="bg-white rounded-lg shadow-md border border-gray-200 overflow-hidden hover:shadow-lg transition-all duration-300 hover:scale-105" data-role="destek">
                <div class="p-3 text-center">
                    <div class="w-12 h-12 mx-auto mb-2 bg-gradient-to-br from-orange-500 to-orange-600 rounded-full flex items-center justify-center">
                        <img src="https://via.placeholder.com/48x48/f59e0b/ffffff?text=🔧" alt="Teknik Destek" class="w-10 h-10 rounded-full">
                    </div>
                    <h4 class="text-sm font-bold text-gray-800 mb-1">Teknik Destek</h4>
                    <p class="text-xs text-gray-600 mb-2">Sistem & Cihaz</p>
                    <div class="flex items-center justify-center space-x-2 text-xs text-gray-500">
                        <span>📧 destek@dvp.com</span>
                    </div>
                    <div class="mt-3">
                        <button onclick="editTeamMember('destek')" class="px-2 py-1 bg-orange-100 hover:bg-orange-200 text-orange-700 text-xs rounded-full transition-colors">
                            ✏️ Düzenle
                        </button>
                    </div>
                </div>
            </div>

            <!-- EKP Kartı -->
            <div class="bg-white rounded-lg shadow-md border border-gray-200 overflow-hidden hover:shadow-lg transition-all duration-300 hover:scale-105" data-role="ekp">
                <div class="p-3 text-center">
                    <div class="w-12 h-12 mx-auto mb-2 bg-gradient-to-br from-purple-500 to-purple-600 rounded-full flex items-center justify-center">
                        <img src="https://via.placeholder.com/48x48/8b5cf6/ffffff?text=📋" alt="EKP" class="w-10 h-10 rounded-full">
                    </div>
                    <h4 class="text-sm font-bold text-gray-800 mb-1">EKP</h4>
                    <p class="text-xs text-gray-600 mb-2">Proje Yönetimi</p>
                    <div class="flex items-center justify-center space-x-2 text-xs text-gray-500">
                        <span>📧 ekp@dvp.com</span>
                    </div>
                    <div class="mt-3">
                        <button onclick="editTeamMember('ekp')" class="px-2 py-1 bg-purple-100 hover:bg-purple-200 text-purple-700 text-xs rounded-full transition-colors">
                            ✏️ Düzenle
                        </button>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- 4 Küçük Grafik -->
    <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-3">
        <!-- Grafik 1: Aylık İlerleme -->
        <div class="card p-3 bg-gradient-to-br from-blue-50 to-indigo-50 border border-blue-200">
            <div class="flex items-center justify-between mb-2">
                <h3 class="text-xs font-semibold text-blue-800">📈 Aylık İlerleme</h3>
                <div class="text-xs text-blue-600 bg-blue-100 px-2 py-1 rounded-full">Son 6 Ay</div>
            </div>
            <div class="h-20 flex items-end justify-between gap-1">
                <div class="flex-1 bg-blue-200 rounded-t" style="height: 20%"></div>
                <div class="flex-1 bg-blue-300 rounded-t" style="height: 35%"></div>
                <div class="flex-1 bg-blue-400 rounded-t" style="height: 50%"></div>
                <div class="flex-1 bg-blue-500 rounded-t" style="height: 70%"></div>
                <div class="flex-1 bg-blue-600 rounded-t" style="height: 85%"></div>
                <div class="flex-1 bg-blue-700 rounded-t" style="height: 95%"></div>
            </div>
            <div class="text-center mt-1">
                <div class="text-base font-bold text-blue-700">%95</div>
                <div class="text-xs text-blue-600">Bu Ay</div>
            </div>
        </div>

        <!-- Grafik 2: Bölgesel Dağılım -->
        <div class="card p-3 bg-gradient-to-br from-green-50 to-emerald-50 border border-green-200">
            <div class="flex items-center justify-between mb-2">
                <h3 class="text-xs font-semibold text-green-800">🗺️ Bölgesel Dağılım</h3>
                <div class="text-xs text-green-600 bg-green-100 px-2 py-1 rounded-full">7 Bölge</div>
            </div>
            <div class="h-20 flex items-center justify-center">
                <div class="relative w-14 h-14">
                    <div class="absolute inset-0 border-4 border-green-200 rounded-full"></div>
                    <div class="absolute inset-0 border-4 border-green-500 rounded-full" style="clip-path: polygon(50% 0%, 100% 0%, 100% 100%, 50% 100%)"></div>
                    <div class="absolute inset-0 border-4 border-green-600 rounded-full" style="clip-path: polygon(50% 0%, 100% 0%, 100% 50%, 50% 50%)"></div>
                    <div class="absolute inset-0 border-4 border-green-700 rounded-full" style="clip-path: polygon(50% 0%, 75% 0%, 75% 25%, 50% 25%)"></div>
                </div>
            </div>
            <div class="text-center mt-1">
                <div class="text-base font-bold text-green-700">%78</div>
                <div class="text-xs text-green-600">Ortalama</div>
            </div>
        </div>

        <!-- Grafik 3: Cihaz Türleri -->
        <div class="card p-4 bg-gradient-to-br from-purple-50 to-violet-50 border border-purple-200">
            <div class="flex items-center justify-between mb-4">
                <h3 class="text-base font-bold text-purple-800">📱 Cihaz Türleri</h3>
                <div class="text-sm text-purple-600 bg-purple-100 px-3 py-1 rounded-full font-medium">6 Kategori</div>
            </div>
            
            <!-- Cihaz Türleri Grid -->
            <div class="grid grid-cols-2 gap-3 mb-4">
                <!-- Sürücü Analiz Kamerası -->
                <div class="bg-white rounded-xl p-3 border-2 border-purple-200 hover:border-purple-400 transition-all duration-300 hover:shadow-lg">
                    <div class="flex items-center space-x-3">
                        <div class="w-12 h-12 bg-purple-100 rounded-full flex items-center justify-center">
                            <span class="text-2xl">📹</span>
                        </div>
                        <div>
                            <div class="font-bold text-purple-800 text-sm">Sürücü Analiz</div>
                            <div class="text-xs text-purple-600">Kamera Sistemi</div>
                        </div>
                    </div>
                </div>

                <!-- ATS Araç Takip -->
                <div class="bg-white rounded-xl p-3 border-2 border-purple-200 hover:border-purple-400 transition-all duration-300 hover:shadow-lg">
                    <div class="flex items-center space-x-3">
                        <div class="w-12 h-12 bg-purple-100 rounded-full flex items-center justify-center">
                            <span class="text-2xl">🚗</span>
                        </div>
                        <div>
                            <div class="font-bold text-purple-800 text-sm">ATS Takip</div>
                            <div class="text-xs text-purple-600">Araç Sistemi</div>
                        </div>
                    </div>
                </div>

                <!-- GPS Konum -->
                <div class="bg-white rounded-xl p-3 border-2 border-purple-200 hover:border-purple-400 transition-all duration-300 hover:shadow-lg">
                    <div class="flex items-center space-x-3">
                        <div class="w-12 h-12 bg-purple-100 rounded-full flex items-center justify-center">
                            <span class="text-2xl">📍</span>
                        </div>
                        <div>
                            <div class="font-bold text-purple-800 text-sm">GPS Konum</div>
                            <div class="text-xs text-purple-600">Takip Sistemi</div>
                        </div>
                    </div>
                </div>

                <!-- Yakıt Takip -->
                <div class="bg-white rounded-xl p-3 border-2 border-purple-200 hover:border-purple-400 transition-all duration-300 hover:shadow-lg">
                    <div class="flex items-center space-x-3">
                        <div class="w-12 h-12 bg-purple-100 rounded-full flex items-center justify-center">
                            <span class="text-2xl">⛽</span>
                        </div>
                        <div>
                            <div class="font-bold text-purple-800 text-sm">Yakıt Takip</div>
                            <div class="text-xs text-purple-600">Maliyet Sistemi</div>
                        </div>
                    </div>
                </div>

                <!-- Motor Monitör -->
                <div class="bg-white rounded-xl p-3 border-2 border-purple-200 hover:border-purple-400 transition-all duration-300 hover:shadow-lg">
                    <div class="flex items-center space-x-3">
                        <div class="w-12 h-12 bg-purple-100 rounded-full flex items-center justify-center">
                            <span class="text-2xl">⚙️</span>
                        </div>
                        <div>
                            <div class="font-bold text-purple-800 text-sm">Motor Monitör</div>
                            <div class="text-xs text-purple-600">Performans Sistemi</div>
                        </div>
                    </div>
                </div>

                <!-- Hız Sensör -->
                <div class="bg-white rounded-xl p-3 border-2 border-purple-200 hover:border-purple-400 transition-all duration-300 hover:shadow-lg">
                    <div class="flex items-center space-x-3">
                        <div class="w-12 h-12 bg-purple-100 rounded-full flex items-center justify-center">
                            <span class="text-2xl">🏃</span>
                        </div>
                        <div>
                            <div class="font-bold text-purple-800 text-sm">Hız Sensör</div>
                            <div class="text-xs text-purple-600">Güvenlik Sistemi</div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- İstatistik -->
            <div class="text-center bg-white rounded-lg p-3 border border-purple-200">
                <div class="text-xl font-bold text-purple-700">%78</div>
                <div class="text-sm text-purple-600 font-medium">Sürücü Analiz Kamerası - En Popüler</div>
            </div>
        </div>

        <!-- Grafik 4: Performans Trendi -->
        <div class="card p-3 bg-gradient-to-br from-orange-50 to-amber-50 border border-orange-200">
            <div class="flex items-center justify-between mb-2">
                <h3 class="text-xs font-semibold text-orange-800">⚡ Performans Trendi</h3>
                <div class="text-xs text-orange-600 bg-orange-100 px-2 py-1 rounded-full">Günlük</div>
            </div>
            <div class="h-20 flex items-center justify-center">
                <svg class="w-full h-full" viewBox="0 0 100 60">
                    <polyline 
                        fill="none" 
                        stroke="#f97316" 
                        stroke-width="2" 
                        points="10,50 25,45 40,35 55,25 70,20 85,15 90,10"
                        class="animate-pulse">
                    </polyline>
                    <circle cx="10" cy="50" r="2" fill="#f97316"/>
                    <circle cx="25" cy="45" r="2" fill="#f97316"/>
                    <circle cx="40" cy="35" r="2" fill="#f97316"/>
                    <circle cx="55" cy="25" r="2" fill="#f97316"/>
                    <circle cx="70" cy="20" r="2" fill="#f97316"/>
                    <circle cx="85" cy="15" r="2" fill="#f97316"/>
                    <circle cx="90" cy="10" r="2" fill="#f97316"/>
                </svg>
            </div>
            <div class="text-center mt-1">
                <div class="text-base font-bold text-orange-700">↗️ +12%</div>
                <div class="text-xs text-orange-600">Bu Hafta</div>
            </div>
        </div>
    </div>

    <!-- Türkiye Geneli Cihaz Durumu -->
    {% if turkiye_toplam_kurulacak or turkiye_toplam_kurulan %}
    <div class="card p-4">
        <h3 class="text-lg font-semibold text-gray-800 mb-3 text-center">🇹🇷 Türkiye Geneli Cihaz Durumu</h3>
                 <!-- Ana İstatistikler -->
         <div class="grid grid-cols-2 md:grid-cols-5 gap-3 text-center mb-4">
             <div class="bg-blue-50 rounded p-2 border border-blue-200">
                 <div class="text-lg font-bold text-blue-600">{{ turkiye_toplam_kurulacak|default:"0" }}</div>
                 <div class="text-xs text-blue-800">🎯 Hedef</div>
             </div>
             
             <div class="bg-green-50 rounded p-2 border border-green-200">
                 <div class="text-lg font-bold text-green-600">{{ turkiye_toplam_kurulan|default:"0" }}</div>
                 <div class="text-xs text-green-800">🚀 Tamamlanan</div>
             </div>
             
             <div class="bg-orange-50 rounded p-2 border border-orange-200">
                 <div class="text-lg font-bold text-orange-600">{{ turkiye_toplam_kalan|default:"0" }}</div>
                 <div class="text-xs text-orange-800">⏳ Kalan</div>
             </div>
             
             <div class="bg-red-50 rounded p-2 border border-red-200">
                 <div class="text-lg font-bold text-red-600">{{ turkiye_toplam_arizali|default:"0" }}</div>
                 <div class="text-xs text-red-800">⚠️ Arızalı</div>
             </div>
             
             <div class="bg-purple-50 rounded p-2 border border-purple-200">
                 <div class="text-lg font-bold text-purple-600">%{{ turkiye_tamamlanma_yuzdesi|default:"0" }}</div>
                 <div class="text-xs text-purple-800">📊 Tamamlanma</div>
             </div>
         </div>
        
                 <!-- Progress Bar -->
         <div class="mt-3">
             <div class="flex justify-between text-sm text-gray-600 mb-2">
                 <span class="font-medium">Genel İlerleme Durumu</span>
                 <span class="font-bold text-purple-600">%{{ turkiye_tamamlanma_yuzdesi|default:"0" }}</span>
             </div>
             <div class="w-full bg-white border border-gray-200 rounded-full h-3 relative overflow-hidden">
                 <div class="h-3 rounded-full transition-all duration-700 ease-out relative" 
                      style="width: {{ turkiye_tamamlanma_yuzdesi|default:0 }}%;
                             background: {% if turkiye_tamamlanma_yuzdesi >= 80 %}linear-gradient(90deg, #10b981, #059669, #047857){% elif turkiye_tamamlanma_yuzdesi >= 60 %}linear-gradient(90deg, #3b82f6, #2563eb, #1d4ed8){% elif turkiye_tamamlanma_yuzdesi >= 40 %}linear-gradient(90deg, #f59e0b, #d97706, #b45309){% else %}linear-gradient(90deg, #ef4444, #dc2626, #b91c1c){% endif %};">
                     <!-- Shine Effect -->
                     <div class="absolute inset-0 bg-gradient-to-r from-transparent via-white to-transparent opacity-20 animate-pulse"></div>
                 </div>
             </div>
             
             <!-- Durum Açıklaması -->
             <div class="text-center mt-2">
                 <span class="text-sm px-3 py-1 rounded-full font-medium
                     {% if turkiye_tamamlanma_yuzdesi >= 80 %}bg-green-100 text-green-800 border border-green-300
                     {% elif turkiye_tamamlanma_yuzdesi >= 60 %}bg-blue-100 text-blue-800 border border-blue-300
                     {% elif turkiye_tamamlanma_yuzdesi >= 40 %}bg-orange-100 text-orange-800 border border-orange-300
                     {% else %}bg-red-100 text-red-800 border border-red-300{% endif %}">
                     {% if turkiye_tamamlanma_yuzdesi >= 80 %}🏆 Mükemmel İlerleme
                     {% elif turkiye_tamamlanma_yuzdesi >= 60 %}👍 İyi İlerleme
                     {% elif turkiye_tamamlanma_yuzdesi >= 40 %}⚠️ Orta İlerleme
                     {% else %}📈 Başlangıç Aşaması{% endif %}
                 </span>
                          </div>
         </div>
         
         <!-- Detaylı Bilgiler -->
         <div class="grid grid-cols-1 md:grid-cols-3 gap-3 text-center text-xs mt-4">
             <div class="bg-gray-50 rounded p-2">
                 <div class="font-medium text-gray-700">Tamamlanma Oranı</div>
                 <div class="text-lg font-bold text-purple-600">%{{ turkiye_tamamlanma_yuzdesi|default:"0" }}</div>
             </div>
             <div class="bg-gray-50 rounded p-2">
                 <div class="font-medium text-gray-700">Kalan İş</div>
                 <div class="text-lg font-bold text-orange-600">{{ turkiye_toplam_kalan|default:"0" }}</div>
             </div>
             <div class="bg-gray-50 rounded p-2">
                 <div class="font-medium text-gray-700">Arıza Oranı</div>
                 <div class="text-lg font-bold text-red-600">%{{ turkiye_toplam_arizali|default:"0"|floatformat:1 }}</div>
             </div>
         </div>
     </div>
     {% endif %}

    <!-- İl Bazında Cihaz Durumu -->
    {% if il_bazinda_istatistikler %}
    <div class="card p-4">
        <h3 class="text-lg font-semibold text-gray-800 mb-3 text-center">🏛️ İl Bazında Cihaz Durumu</h3>
        <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-3">
            {% for istatistik in il_bazinda_istatistikler|slice:":6" %}
            <div class="bg-gray-50 rounded p-3">
                <h4 class="font-semibold text-gray-800 text-sm mb-2">{{ istatistik.il_adi }}</h4>
                                 <!-- İlerleme Durumu Progress Bar -->
                 <div class="mb-3">
                     <div class="flex justify-between text-xs text-gray-600 mb-1">
                         <span>İlerleme</span>
                         <span class="font-medium">%{{ istatistik.tamamlanma_yuzdesi|default:"0" }}</span>
                     </div>
                     <div class="w-full bg-white border border-gray-200 rounded-full h-2 relative overflow-hidden">
                         <div class="h-2 rounded-full transition-all duration-500 ease-out" 
                              style="width: {{ istatistik.tamamlanma_yuzdesi|default:0 }}%;
                                     background: {% if istatistik.tamamlanma_yuzdesi >= 80 %}linear-gradient(90deg, #10b981, #059669){% elif istatistik.tamamlanma_yuzdesi >= 60 %}linear-gradient(90deg, #3b82f6, #2563eb){% elif istatistik.tamamlanma_yuzdesi >= 40 %}linear-gradient(90deg, #f59e0b, #d97706){% else %}linear-gradient(90deg, #ef4444, #dc2626){% endif %};">
                         </div>
                     </div>
                 </div>
                 
                 <!-- Cihaz Sayıları Grid -->
                 <div class="grid grid-cols-4 gap-2 text-center text-xs mb-2">
                     <div class="text-blue-600 font-medium">{{ istatistik.veri.kurulacak_cihaz_sayisi|default:"0" }}</div>
                     <div class="text-green-600 font-medium">{{ istatistik.veri.kurulan_cihaz_sayisi|default:"0" }}</div>
                     <div class="text-orange-600 font-medium">{{ istatistik.kalan_cihaz|default:"0" }}</div>
                     <div class="text-red-600 font-medium">{{ istatistik.veri.arizali_cihaz_sayisi|default:"0" }}</div>
                 </div>
                 
                 <!-- Durum Etiketi -->
                 <div class="text-center">
                     <span class="text-xs px-2 py-1 rounded-full font-medium
                         {% if istatistik.tamamlanma_yuzdesi >= 80 %}bg-green-100 text-green-800 border border-green-200
                         {% elif istatistik.tamamlanma_yuzdesi >= 60 %}bg-blue-100 text-blue-800 border border-blue-200
                         {% elif istatistik.tamamlanma_yuzdesi >= 40 %}bg-orange-100 text-orange-800 border border-orange-200
                         {% else %}bg-red-100 text-red-800 border border-red-200{% endif %}">
                         {% if istatistik.tamamlanma_yuzdesi >= 80 %}🏆 Mükemmel
                         {% elif istatistik.tamamlanma_yuzdesi >= 60 %}👍 İyi
                         {% elif istatistik.tamamlanma_yuzdesi >= 40 %}⚠️ Orta
                         {% else %}📈 Başlangıç{% endif %}
                     </span>
                 </div>
            </div>
            {% endfor %}
        </div>
    </div>
    {% endif %}

    <!-- Quick Actions -->
    <div class="card p-4 bg-gradient-to-r from-gray-50 to-blue-50">
        <h3 class="text-lg font-semibold text-gray-800 mb-4 text-center">🚀 Hızlı İşlemler</h3>
        <div class="grid grid-cols-2 md:grid-cols-4 gap-3">
            <a href="{% url 'veri_yonetimi:veri_listesi' %}" 
               class="group relative overflow-hidden rounded-lg bg-gradient-to-r from-blue-500 to-blue-600 p-3 text-center text-white shadow-lg transition-all duration-300 hover:from-blue-600 hover:to-blue-700 hover:shadow-xl hover:scale-105">
                <div class="text-lg mb-1">📊</div>
                <div class="text-sm font-medium">Veri Listesi</div>
                <div class="absolute inset-0 bg-gradient-to-r from-transparent via-white to-transparent opacity-0 group-hover:opacity-20 transition-opacity duration-300"></div>
            </a>
            
            <a href="{% url 'veri_yonetimi:sutun_listesi' %}" 
               class="group relative overflow-hidden rounded-lg bg-gradient-to-r from-gray-500 to-gray-600 p-3 text-center text-white shadow-lg transition-all duration-300 hover:from-gray-600 hover:to-gray-700 hover:shadow-xl hover:scale-105">
                <div class="text-lg mb-1">⚙️</div>
                <div class="text-sm font-medium">Sütun Yönetimi</div>
                <div class="absolute inset-0 bg-gradient-to-r from-transparent via-white to-transparent opacity-0 group-hover:opacity-20 transition-opacity duration-300"></div>
            </a>
            
            {% if user.is_superuser %}
                <a href="{% url 'veri_yonetimi:veri_ekle' %}" 
                   class="group relative overflow-hidden rounded-lg bg-gradient-to-r from-green-500 to-green-600 p-3 text-center text-white shadow-lg transition-all duration-300 hover:from-green-600 hover:to-green-700 hover:shadow-xl hover:scale-105">
                    <div class="text-lg mb-1">➕</div>
                    <div class="text-sm font-medium">Veri Ekle</div>
                    <div class="absolute inset-0 bg-gradient-to-r from-transparent via-white to-transparent opacity-0 group-hover:opacity-20 transition-opacity duration-300"></div>
                </a>
                
                <a href="{% url 'veri_yonetimi:kullanici_listesi' %}" 
                   class="group relative overflow-hidden rounded-lg bg-gradient-to-r from-purple-500 to-purple-600 p-3 text-center text-white shadow-lg transition-all duration-300 hover:from-purple-600 hover:to-purple-700 hover:shadow-xl hover:scale-105">
                    <div class="text-lg mb-1">👥</div>
                    <div class="text-sm font-medium">Kullanıcı Yönetimi</div>
                    <div class="absolute inset-0 bg-gradient-to-r from-transparent via-white to-transparent opacity-0 group-hover:opacity-20 transition-opacity duration-300"></div>
                </a>
            {% endif %}
        </div>
    </div>
</div>
{% endblock %}

{% block extra_js %}
<script>
// Geriye Sayan Sayaç - 3 Ay
function updateCountdown() {
    const now = new Date();
    const targetDate = new Date(now.getFullYear(), now.getMonth() + 3, now.getDate());
    const currentTime = new Date().getTime();
    const timeLeft = targetDate.getTime() - currentTime;
    
    if (timeLeft > 0) {
        const months = Math.floor(timeLeft / (1000 * 60 * 60 * 24 * 30.44));
        const days = Math.floor((timeLeft % (1000 * 60 * 60 * 24 * 30.44)) / (1000 * 60 * 60 * 24));
        const hours = Math.floor((timeLeft % (1000 * 60 * 60 * 24)) / (1000 * 60 * 60));
        const seconds = Math.floor((timeLeft % (1000 * 60 * 60)) / 1000);
        
        document.getElementById('months').textContent = months;
        document.getElementById('days').textContent = days;
        document.getElementById('hours').textContent = hours;
        document.getElementById('seconds').textContent = seconds;
        
        setTimeout(updateCountdown, 1000);
    } else {
        document.getElementById('countdown').innerHTML = '<div class="col-span-4 text-center"><div class="text-lg font-bold text-red-600">⏰ Süre Doldu!</div></div>';
    }
}

// Ekip üyesi düzenleme fonksiyonu
function editTeamMember(role) {
    const memberData = {
        'yonetici': {
            title: 'Yönetici',
            name: 'Ahmet Yılmaz',
            email: 'yonetici@dvp.com',
            phone: '+90 555 123 4567',
            department: 'Genel Koordinasyon',
            avatar: '👔',
            photo: null
        },
        'yazilim': {
            title: 'Yazılım',
            name: 'Mehmet Demir',
            email: 'yazilim@dvp.com',
            phone: '+90 555 234 5678',
            department: 'Geliştirme & Bakım',
            avatar: '💻',
            photo: null
        },
        'destek': {
            title: 'Teknik Destek',
            name: 'Fatma Kaya',
            email: 'destek@dvp.com',
            phone: '+90 555 345 6789',
            department: 'Sistem & Cihaz',
            avatar: '🔧',
            photo: null
        },
        'ekp': {
            title: 'EKP',
            name: 'Ali Özkan',
            email: 'ekp@dvp.com',
            phone: '+90 555 456 7890',
            department: 'Proje Yönetimi',
            avatar: '📋',
            photo: null
        }
    };
    
    const member = memberData[role];
    
    // Modal oluştur
    const modal = document.createElement('div');
    modal.className = 'fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50';
    modal.innerHTML = `
        <div class="bg-white rounded-2xl p-6 max-w-md w-full mx-4 shadow-2xl">
            <div class="flex items-center justify-between mb-4">
                <h3 class="text-lg font-bold text-gray-800">${member.title} Bilgilerini Düzenle</h3>
                <button onclick="this.closest('.fixed').remove()" class="text-gray-400 hover:text-gray-600 text-xl">
                    ✕
                </button>
            </div>
            
            <div class="space-y-4">
                <!-- Avatar Seçimi -->
                <div>
                    <label class="block text-sm font-medium text-gray-700 mb-2">🖼️ Profil Fotoğrafı</label>
                    <div class="flex items-center space-x-3">
                        <div id="avatarPreview" class="w-16 h-16 bg-gradient-to-br from-blue-500 to-blue-600 rounded-full flex items-center justify-center text-2xl text-white overflow-hidden">
                            ${member.photo ? `<img src="${member.photo}" alt="Profil" class="w-full h-full object-cover">` : member.avatar}
                        </div>
                        <div class="flex-1">
                            <input type="file" id="photoInput" accept="image/*" class="w-full px-3 py-2 border border-gray-300 rounded-lg text-sm" onchange="previewPhoto(this)">
                            <p class="text-xs text-gray-500 mt-1">PNG, JPG veya GIF (max 2MB)</p>
                        </div>
                    </div>
                </div>
                
                <!-- Ad Soyad -->
                <div>
                    <label class="block text-sm font-medium text-gray-700 mb-2">👤 Ad Soyad</label>
                    <input type="text" id="nameInput" value="${member.name}" class="w-full px-3 py-2 border border-gray-300 rounded-lg text-sm focus:border-blue-500 focus:ring-1 focus:ring-blue-500">
                </div>
                
                <!-- E-posta -->
                <div>
                    <label class="block text-sm font-medium text-gray-700 mb-2">📧 E-posta</label>
                    <input type="email" id="emailInput" value="${member.email}" class="w-full px-3 py-2 border border-gray-300 rounded-lg text-sm focus:border-blue-500 focus:ring-1 focus:ring-blue-500">
                </div>
                
                <!-- Telefon -->
                <div>
                    <label class="block text-sm font-medium text-gray-700 mb-2">📱 Telefon</label>
                    <input type="tel" id="phoneInput" value="${member.phone}" class="w-full px-3 py-2 border border-gray-300 rounded-lg text-sm focus:border-blue-500 focus:ring-1 focus:ring-blue-500">
                </div>
                
                <!-- Departman -->
                <div>
                    <label class="block text-sm font-medium text-gray-700 mb-2">🏢 Departman</label>
                    <input type="text" id="departmentInput" value="${member.department}" class="w-full px-3 py-2 border border-gray-300 rounded-lg text-sm focus:border-blue-500 focus:ring-1 focus:ring-blue-500">
                </div>
            </div>
            
            <div class="flex gap-3 mt-6">
                <button onclick="saveTeamMember('${role}')" class="flex-1 bg-blue-600 hover:bg-blue-700 text-white py-2 px-4 rounded-lg font-medium transition-colors">
                    💾 Kaydet
                </button>
                <button onclick="this.closest('.fixed').remove()" class="flex-1 bg-gray-300 hover:bg-gray-400 text-gray-700 py-2 px-4 rounded-lg font-medium transition-colors">
                    ❌ İptal
                </button>
            </div>
        </div>
    `;
    
    document.body.appendChild(modal);
}

// Fotoğraf önizleme fonksiyonu
function previewPhoto(input) {
    const file = input.files[0];
    if (file) {
        // Dosya boyutu kontrolü (2MB)
        if (file.size > 2 * 1024 * 1024) {
            alert('Dosya boyutu 2MB\'dan büyük olamaz!');
            input.value = '';
            return;
        }
        
        // Dosya türü kontrolü
        if (!file.type.startsWith('image/')) {
            alert('Lütfen geçerli bir resim dosyası seçin!');
            input.value = '';
            return;
        }
        
        const reader = new FileReader();
        reader.onload = function(e) {
            const avatarPreview = document.getElementById('avatarPreview');
            avatarPreview.innerHTML = `<img src="${e.target.result}" alt="Profil" class="w-full h-full object-cover">`;
            avatarPreview.className = 'w-16 h-16 rounded-full overflow-hidden';
        };
        reader.readAsDataURL(file);
    }
}

// Ekip üyesi kaydetme fonksiyonu
function saveTeamMember(role) {
    // Form verilerini al
    const name = document.getElementById('nameInput').value.trim();
    const email = document.getElementById('emailInput').value.trim();
    const phone = document.getElementById('phoneInput').value.trim();
    const department = document.getElementById('departmentInput').value.trim();
    const photoInput = document.getElementById('photoInput');
    
    // Validasyon
    if (!name || !email || !phone || !department) {
        showNotification('Lütfen tüm alanları doldurun!', 'error');
        return;
    }
    
    if (!email.includes('@')) {
        showNotification('Geçerli bir e-posta adresi girin!', 'error');
        return;
    }
    
    // Fotoğraf işleme
    let photoData = null;
    if (photoInput.files[0]) {
        const file = photoInput.files[0];
        const reader = new FileReader();
        reader.onload = function(e) {
            photoData = e.target.result;
            
            // LocalStorage'a kaydet
            const memberData = {
                name: name,
                email: email,
                phone: phone,
                department: department,
                photo: photoData,
                updatedAt: new Date().toISOString()
            };
            
            localStorage.setItem(`teamMember_${role}`, JSON.stringify(memberData));
            
            // Kartı güncelle
            updateTeamMemberCard(role, memberData);
            
            showNotification(`${role.charAt(0).toUpperCase() + role.slice(1)} bilgileri kaydedildi!`, 'success');
            
            // Modal'ı kapat
            document.querySelector('.fixed').remove();
        };
        reader.readAsDataURL(file);
    } else {
        // Fotoğraf yoksa sadece diğer bilgileri kaydet
        const memberData = {
            name: name,
            email: email,
            phone: phone,
            department: department,
            photo: null,
            updatedAt: new Date().toISOString()
        };
        
        localStorage.setItem(`teamMember_${role}`, JSON.stringify(memberData));
        
        // Kartı güncelle
        updateTeamMemberCard(role, memberData);
        
        showNotification(`${role.charAt(0).toUpperCase() + role.slice(1)} bilgileri kaydedildi!`, 'success');
        
        // Modal'ı kapat
        document.querySelector('.fixed').remove();
    }
}

// Ekip üyesi kartını güncelleme fonksiyonu
function updateTeamMemberCard(role, memberData) {
    const card = document.querySelector(`[data-role="${role}"]`);
    if (card) {
        // Avatar güncelle
        const avatarDiv = card.querySelector('.w-12.h-12');
        if (memberData.photo) {
            avatarDiv.innerHTML = `<img src="${memberData.photo}" alt="${memberData.name}" class="w-10 h-10 rounded-full object-cover">`;
        } else {
            // Varsayılan avatar'ı geri yükle
            const defaultAvatars = {
                'yonetici': '👔',
                'yazilim': '💻',
                'destek': '🔧',
                'ekp': '📋'
            };
            avatarDiv.innerHTML = `<span class="text-2xl">${defaultAvatars[role]}</span>`;
        }
        
        // İsim güncelle
        const nameElement = card.querySelector('h4');
        if (nameElement) nameElement.textContent = memberData.name;
        
        // Departman güncelle
        const deptElement = card.querySelector('p');
        if (deptElement) deptElement.textContent = memberData.department;
        
        // E-posta güncelle
        const emailElement = card.querySelector('.text-xs.text-gray-500 span');
        if (emailElement) emailElement.textContent = `📧 ${memberData.email}`;
    }
}

// Sayfa yüklendiğinde kaydedilmiş verileri yükle
document.addEventListener('DOMContentLoaded', function() {
    // Mevcut countdown kodunu koru
    updateCountdown();
    
    // Kaydedilmiş ekip üyesi verilerini yükle
    const roles = ['yonetici', 'yazilim', 'destek', 'ekp'];
    roles.forEach(role => {
        const savedData = localStorage.getItem(`teamMember_${role}`);
        if (savedData) {
            try {
                const memberData = JSON.parse(savedData);
                updateTeamMemberCard(role, memberData);
            } catch (e) {
                console.error('Kaydedilmiş veri yüklenemedi:', e);
            }
        }
    });
});

// Bildirim gösterme fonksiyonu
function showNotification(message, type = 'info') {
    const notification = document.createElement('div');
    notification.className = `fixed top-4 right-4 p-4 rounded-lg shadow-lg z-50 transform transition-all duration-300 translate-x-full`;
    
    const colors = {
        'success': 'bg-green-500 text-white',
        'error': 'bg-red-500 text-white',
        'warning': 'bg-yellow-500 text-white',
        'info': 'bg-blue-500 text-white'
    };
    
    notification.className += ` ${colors[type] || colors.info}`;
    notification.innerHTML = `
        <div class="flex items-center space-x-2">
            <span>${type === 'success' ? '✅' : type === 'error' ? '❌' : type === 'warning' ? '⚠️' : 'ℹ️'}</span>
            <span>${message}</span>
        </div>
    `;
    
    document.body.appendChild(notification);
    
    // Animasyon
    setTimeout(() => {
        notification.classList.remove('translate-x-full');
    }, 100);
    
    // Otomatik kaldır
    setTimeout(() => {
        notification.classList.add('translate-x-full');
        setTimeout(() => {
            notification.remove();
        }, 300);
    }, 3000);
}
</script>
{% endblock %}
