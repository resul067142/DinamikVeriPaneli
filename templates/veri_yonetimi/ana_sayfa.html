{% extends 'base.html' %}
{% load custom_filters %}

{% block title %}Ana Sayfa - Genel BakÄ±ÅŸ ve Ä°statistikler - {{ app_name|default:"DVP" }}{% endblock %}

{% block content %}
<div class="space-y-4">

    
    <!-- YÃ¶netim ve Destek KartlarÄ± -->
    <div class="card p-3 bg-gradient-to-r from-gray-50 to-blue-50 border border-gray-200">
        <h3 class="text-base font-semibold text-gray-800 mb-3 text-center">ğŸ‘¥ YÃ¶netim ve Destek Ekibi</h3>
        <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-3">
            <!-- YÃ¶netici KartÄ± -->
            <div class="bg-white rounded-lg shadow-md border border-gray-200 overflow-hidden hover:shadow-lg transition-all duration-300 hover:scale-105" data-role="yonetici">
                <div class="p-3 text-center">
                    <div class="w-12 h-12 mx-auto mb-2 bg-gradient-to-br from-blue-500 to-blue-600 rounded-full flex items-center justify-center">
                        <span class="text-2xl">ğŸ‘”</span>
                    </div>
                    <h4 class="text-sm font-bold text-gray-800 mb-1">Resul AKTAÅ</h4>
                    <p class="text-xs text-gray-600 mb-2">Genel Koordinasyon</p>
                    <div class="flex items-center justify-center space-x-2 text-xs text-gray-500">
                        <span>ğŸ“§ yonetici@dvp.com</span>
                    </div>
                    <div class="flex items-center justify-center space-x-2 text-xs text-gray-500 mt-1">
                        <span>ğŸ“ +90 312 456 78 90 / 102</span>
                    </div>
                    {% if user.is_superuser %}
                    <div class="mt-3">
                        <button onclick="editTeamMember('yonetici')" class="px-2 py-1 bg-blue-100 hover:bg-blue-200 text-blue-700 text-xs rounded-full transition-colors">
                            âœï¸ DÃ¼zenle
                        </button>
                    </div>
                    {% endif %}
                </div>
            </div>

            <!-- YazÄ±lÄ±m KartÄ± -->
            <div class="bg-white rounded-lg shadow-md border border-gray-200 overflow-hidden hover:shadow-lg transition-all duration-300 hover:scale-105" data-role="yazilim">
                <div class="p-3 text-center">
                    <div class="w-12 h-12 mx-auto mb-2 bg-gradient-to-br from-green-500 to-green-600 rounded-full flex items-center justify-center">
                        <span class="text-2xl">ğŸ’»</span>
                    </div>
                    <h4 class="text-sm font-bold text-gray-800 mb-1">Mehmet Demir</h4>
                    <p class="text-xs text-gray-600 mb-2">GeliÅŸtirme & BakÄ±m</p>
                    <div class="flex items-center justify-center space-x-2 text-xs text-gray-500">
                        <span>ğŸ“§ yazilim@dvp.com</span>
                    </div>
                    <div class="flex items-center justify-center space-x-2 text-xs text-gray-500 mt-1">
                        <span>ğŸ“ +90 312 456 78 90 / 103</span>
                    </div>
                    {% if user.is_superuser %}
                    <div class="mt-3">
                        <button onclick="editTeamMember('yazilim')" class="px-2 py-1 bg-green-100 hover:bg-green-200 text-green-700 text-xs rounded-full transition-colors">
                            âœï¸ DÃ¼zenle
                        </button>
                    </div>
                    {% endif %}
                </div>
            </div>

            <!-- Teknik Destek KartÄ± -->
            <div class="bg-white rounded-lg shadow-md border border-gray-200 overflow-hidden hover:shadow-lg transition-all duration-300 hover:scale-105" data-role="destek">
                <div class="p-3 text-center">
                    <div class="w-12 h-12 mx-auto mb-2 bg-gradient-to-br from-orange-500 to-orange-600 rounded-full flex items-center justify-center">
                        <span class="text-2xl">ğŸ”§</span>
                    </div>
                    <h4 class="text-sm font-bold text-gray-800 mb-1">Fatma Kaya</h4>
                    <p class="text-xs text-gray-600 mb-2">Sistem & Cihaz</p>
                    <div class="flex items-center justify-center space-x-2 text-xs text-gray-500">
                        <span>ğŸ“§ destek@dvp.com</span>
                    </div>
                    <div class="flex items-center justify-center space-x-2 text-xs text-gray-500 mt-1">
                        <span>ğŸ“ +90 312 456 78 90 / 104</span>
                    </div>
                    {% if user.is_superuser %}
                    <div class="mt-3">
                        <button onclick="editTeamMember('destek')" class="px-2 py-1 bg-orange-100 hover:bg-orange-200 text-orange-700 text-xs rounded-full transition-colors">
                            âœï¸ DÃ¼zenle
                        </button>
                    </div>
                    {% endif %}
                </div>
            </div>

            <!-- EKP KartÄ± -->
            <div class="bg-white rounded-lg shadow-md border border-gray-200 overflow-hidden hover:shadow-lg transition-all duration-300 hover:scale-105" data-role="ekp">
                <div class="p-3 text-center">
                    <div class="w-12 h-12 mx-auto mb-2 bg-gradient-to-br from-purple-500 to-purple-600 rounded-full flex items-center justify-center">
                        <span class="text-2xl">ğŸ“‹</span>
                    </div>
                    <h4 class="text-sm font-bold text-gray-800 mb-1">Ali Ã–zkan</h4>
                    <p class="text-xs text-gray-600 mb-2">Proje YÃ¶netimi</p>
                    <div class="flex items-center justify-center space-x-2 text-xs text-gray-500">
                        <span>ğŸ“§ ekp@dvp.com</span>
                    </div>
                    <div class="flex items-center justify-center space-x-2 text-xs text-gray-500 mt-1">
                        <span>ğŸ“ +90 312 456 78 90 / 105</span>
                    </div>
                    {% if user.is_superuser %}
                    <div class="mt-3">
                        <button onclick="editTeamMember('ekp')" class="px-2 py-1 bg-purple-100 hover:bg-purple-200 text-purple-700 text-xs rounded-full transition-colors">
                            âœï¸ DÃ¼zenle
                        </button>
                    </div>
                    {% endif %}
                </div>
            </div>
        </div>
    </div>

    <!-- TÃ¼rkiye Geneli Cihaz Durumu -->
    {% if turkiye_toplam_kurulacak or turkiye_toplam_kurulan %}
    <div class="card p-4">
        <h3 class="text-lg font-semibold text-gray-800 mb-3 text-center">ğŸ‡¹ğŸ‡· TÃ¼rkiye Geneli Cihaz Durumu</h3>
        
        <!-- Proje Geri SayÄ±mÄ± -->
        <div class="bg-gradient-to-r from-orange-50 to-red-50 rounded-lg p-2 mb-3 border border-orange-200">
            <div class="flex items-center justify-between mb-2">
                <h4 class="text-xs font-semibold text-orange-800">â° Proje Hedefi</h4>
                <button onclick="editTargetDate()" class="text-xs bg-orange-100 hover:bg-orange-200 text-orange-700 px-1 py-0.5 rounded transition-colors">
                    âœï¸
                </button>
            </div>
            <div id="countdown-timer" class="grid grid-cols-5 gap-1 text-center mb-1">
                <div class="bg-white rounded p-1 border border-orange-200">
                    <div id="countdown-months" class="text-sm font-bold text-orange-600">0</div>
                    <div class="text-xs text-orange-800">Ay</div>
                </div>
                <div class="bg-white rounded p-1 border border-orange-200">
                    <div id="countdown-days" class="text-sm font-bold text-orange-600">0</div>
                    <div class="text-xs text-orange-800">GÃ¼n</div>
                </div>
                <div class="bg-white rounded p-1 border border-orange-200">
                    <div id="countdown-hours" class="text-sm font-bold text-orange-600">0</div>
                    <div class="text-xs text-orange-800">Saat</div>
                </div>
                <div class="bg-white rounded p-1 border border-orange-200">
                    <div id="countdown-minutes" class="text-sm font-bold text-orange-600">0</div>
                    <div class="text-xs text-orange-800">Dk</div>
                </div>
                <div class="bg-white rounded p-1 border border-orange-200">
                    <div id="countdown-seconds" class="text-sm font-bold text-orange-600">0</div>
                    <div class="text-xs text-orange-800">Sn</div>
                </div>
            </div>
            <div id="target-date-display" class="text-xs text-orange-600 text-center">
                <span id="target-date-text">HenÃ¼z belirlenmedi</span>
            </div>
        </div>
        
                 <!-- Ana Ä°statistikler -->
         <div class="grid grid-cols-2 md:grid-cols-5 gap-3 text-center mb-4">
             <div class="bg-blue-50 rounded p-2 border border-blue-200">
                 <div class="text-lg font-bold text-blue-600">{{ turkiye_toplam_kurulacak|default:"0" }}</div>
                 <div class="text-xs text-blue-800">ğŸ¯ Hedef</div>
             </div>
             
             <div class="bg-green-50 rounded p-2 border border-green-200">
                 <div class="text-lg font-bold text-green-600">{{ turkiye_toplam_kurulan|default:"0" }}</div>
                 <div class="text-xs text-green-800">ğŸš€ Tamamlanan</div>
             </div>
             
             <div class="bg-orange-50 rounded p-2 border border-orange-200">
                 <div class="text-lg font-bold text-orange-600">{{ turkiye_toplam_kalan|default:"0" }}</div>
                 <div class="text-xs text-orange-800">â³ Kalan</div>
             </div>
             
             <div class="bg-red-50 rounded p-2 border border-red-200">
                 <div class="text-lg font-bold text-red-600">{{ turkiye_toplam_arizali|default:"0" }}</div>
                 <div class="text-xs text-red-800">âš ï¸ ArÄ±zalÄ±</div>
             </div>
             
             <div class="bg-purple-50 rounded p-2 border border-purple-200">
                 <div class="text-lg font-bold text-purple-600">%{{ turkiye_tamamlanma_yuzdesi|floatformat:3 }}</div>
                 <div class="text-xs text-purple-800">ğŸ“Š Tamamlanma</div>
             </div>
         </div>
        
                 <!-- Progress Bar -->
    </div>
    {% endif %}

    <!-- Ä°l BazÄ±nda Cihaz Durumu -->
    {% if il_bazinda_istatistikler %}
    <div class="card p-4">
        <h3 class="text-lg font-semibold text-gray-800 mb-3 text-center">ğŸ›ï¸ Ä°l BazÄ±nda Cihaz Durumu</h3>
        <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-3">
            {% for istatistik in il_bazinda_istatistikler|slice:":6" %}
            <div class="bg-gray-50 rounded p-3">
                <h4 class="font-semibold text-gray-800 text-sm mb-2">{{ istatistik.il_adi }}</h4>
                                 <!-- Ä°lerleme Durumu Progress Bar -->
                 <div class="mb-3">
                     <div class="flex justify-between text-xs text-gray-600 mb-1">
                         <span>Ä°lerleme</span>
                         <span class="font-medium">%{{ istatistik.tamamlanma_yuzdesi|floatformat:3 }}</span>
                     </div>
                     <div class="w-full bg-white border border-gray-200 rounded-full h-2 relative overflow-hidden">
                         <div class="h-2 rounded-full transition-all duration-500 ease-out" 
                              style="width: {{ istatistik.tamamlanma_yuzdesi|default:0 }}%;
                                     background: {% if istatistik.tamamlanma_yuzdesi >= 80 %}linear-gradient(90deg, #10b981, #059669){% elif istatistik.tamamlanma_yuzdesi >= 60 %}linear-gradient(90deg, #3b82f6, #2563eb){% elif istatistik.tamamlanma_yuzdesi >= 40 %}linear-gradient(90deg, #f59e0b, #d97706){% else %}linear-gradient(90deg, #ef4444, #dc2626){% endif %};">
                         </div>
                     </div>
                 </div>
                 
                 <!-- Cihaz SayÄ±larÄ± Grid -->
                 <div class="grid grid-cols-4 gap-2 text-center text-xs mb-2">
                     <div class="text-blue-600 font-medium">{{ istatistik.veri.kurulacak_cihaz_sayisi|default:"0" }}</div>
                     <div class="text-green-600 font-medium">{{ istatistik.veri.kurulan_cihaz_sayisi|default:"0" }}</div>
                     <div class="text-orange-600 font-medium">{{ istatistik.kalan_cihaz|default:"0" }}</div>
                     <div class="text-red-600 font-medium">{{ istatistik.veri.arizali_cihaz_sayisi|default:"0" }}</div>
                 </div>
                 
                 <!-- Durum Etiketi -->
                 <div class="text-center">
                     <span class="text-xs px-2 py-1 rounded-full font-medium
                         {% if istatistik.tamamlanma_yuzdesi >= 80 %}bg-green-100 text-green-800 border border-green-200
                         {% elif istatistik.tamamlanma_yuzdesi >= 60 %}bg-blue-100 text-blue-800 border border-blue-200
                         {% elif istatistik.tamamlanma_yuzdesi >= 40 %}bg-orange-100 text-orange-800 border border-orange-200
                         {% else %}bg-red-100 text-red-800 border border-red-200{% endif %}">
                         {% if istatistik.tamamlanma_yuzdesi >= 80 %}ğŸ† MÃ¼kemmel
                         {% elif istatistik.tamamlanma_yuzdesi >= 60 %}ğŸ‘ Ä°yi
                         {% elif istatistik.tamamlanma_yuzdesi >= 40 %}âš ï¸ Orta
                         {% else %}ğŸ“ˆ BaÅŸlangÄ±Ã§{% endif %}
                     </span>
                 </div>
            </div>
            {% endfor %}
        </div>
    </div>
    {% endif %}

</div>
{% endblock %}

{% block extra_js %}
<script>
// Ekip Ã¼yesi dÃ¼zenleme fonksiyonu
function editTeamMember(role) {
    const memberData = {
        'yonetici': {
            title: 'Genel KoordinatÃ¶r',
            name: 'Resul AKTAÅ',
            email: 'yonetici@dvp.com',
            phone: '+90 312 456 78 90',
            extension: '102',
            department: 'Genel Koordinasyon',
            avatar: 'ğŸ‘”',
            photo: null
        },
        'yazilim': {
            title: 'YazÄ±lÄ±m GeliÅŸtirici',
            name: 'Mehmet Demir',
            email: 'yazilim@dvp.com',
            phone: '+90 312 456 78 90',
            extension: '103',
            department: 'GeliÅŸtirme & BakÄ±m',
            avatar: 'ğŸ’»',
            photo: null
        },
        'destek': {
            title: 'Teknik Destek',
            name: 'Fatma Kaya',
            email: 'destek@dvp.com',
            phone: '+90 312 456 78 90',
            extension: '104',
            department: 'Sistem & Cihaz',
            avatar: 'ğŸ”§',
            photo: null
        },
        'ekp': {
            title: 'Proje YÃ¶neticisi',
            name: 'Ali Ã–zkan',
            email: 'ekp@dvp.com',
            phone: '+90 312 456 78 90',
            extension: '105',
            department: 'Proje YÃ¶netimi',
            avatar: 'ğŸ“‹',
            photo: null
        }
    };
    
    const member = memberData[role];
    
    // Modal oluÅŸtur
    const modal = document.createElement('div');
    modal.className = 'fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50';
    modal.innerHTML = `
        <div class="bg-white rounded-2xl p-6 max-w-md w-full mx-4 shadow-2xl">
            <div class="flex items-center justify-between mb-4">
                <h3 class="text-lg font-bold text-gray-800">${member.title} Bilgilerini DÃ¼zenle</h3>
                <button onclick="this.closest('.fixed').remove()" class="text-gray-400 hover:text-gray-600 text-xl">
                    âœ•
                </button>
            </div>
            
            <div class="space-y-4">
                <!-- Avatar SeÃ§imi -->
                <div>
                    <label class="block text-sm font-medium text-gray-700 mb-2">ğŸ–¼ï¸ Profil FotoÄŸrafÄ±</label>
                    <div class="flex items-center space-x-3">
                        <div id="avatarPreview" class="w-16 h-16 bg-gradient-to-br from-blue-500 to-blue-600 rounded-full flex items-center justify-center text-2xl text-white overflow-hidden">
                            ${member.photo ? `<img src="${member.photo}" alt="Profil" class="w-full h-full object-cover">` : member.avatar}
                        </div>
                        <div class="flex-1">
                            <input type="file" id="photoInput" accept="image/*" class="w-full px-3 py-2 border border-gray-300 rounded-lg text-sm" onchange="previewPhoto(this)">
                            <p class="text-xs text-gray-500 mt-1">PNG, JPG veya GIF (max 2MB)</p>
                        </div>
                    </div>
                </div>
                
                <!-- Ad Soyad -->
                <div>
                    <label class="block text-sm font-medium text-gray-700 mb-2">ğŸ‘¤ Ad Soyad</label>
                    <input type="text" id="nameInput" value="${member.name}" class="w-full px-3 py-2 border border-gray-300 rounded-lg text-sm focus:border-blue-500 focus:ring-1 focus:ring-blue-500">
                </div>
                
                <!-- E-posta -->
                <div>
                    <label class="block text-sm font-medium text-gray-700 mb-2">ğŸ“§ E-posta</label>
                    <input type="email" id="emailInput" value="${member.email}" class="w-full px-3 py-2 border border-gray-300 rounded-lg text-sm focus:border-blue-500 focus:ring-1 focus:ring-blue-500">
                </div>
                
                <!-- Telefon -->
                <div>
                    <label class="block text-sm font-medium text-gray-700 mb-2">ğŸ“± Telefon</label>
                    <input type="tel" id="phoneInput" value="${member.phone}" class="w-full px-3 py-2 border border-gray-300 rounded-lg text-sm focus:border-blue-500 focus:ring-1 focus:ring-blue-500">
                </div>
                
                <!-- Dahili -->
                <div>
                    <label class="block text-sm font-medium text-gray-700 mb-2">ğŸ“ Dahili</label>
                    <input type="text" id="extensionInput" value="${member.extension || ''}" class="w-full px-3 py-2 border border-gray-300 rounded-lg text-sm focus:border-blue-500 focus:ring-1 focus:ring-blue-500" placeholder="Ã–rnek: 102">
                </div>
                
                <!-- Departman -->
                <div>
                    <label class="block text-sm font-medium text-gray-700 mb-2">ğŸ¢ Departman</label>
                    <input type="text" id="departmentInput" value="${member.department}" class="w-full px-3 py-2 border border-gray-300 rounded-lg text-sm focus:border-blue-500 focus:ring-1 focus:ring-blue-500">
                </div>
            </div>
            
            <div class="flex gap-3 mt-6">
                <button onclick="saveTeamMember('${role}')" class="flex-1 bg-blue-600 hover:bg-blue-700 text-white py-2 px-4 rounded-lg font-medium transition-colors">
                    ğŸ’¾ Kaydet
                </button>
                <button onclick="this.closest('.fixed').remove()" class="flex-1 bg-gray-300 hover:bg-gray-400 text-gray-700 py-2 px-4 rounded-lg font-medium transition-colors">
                    âŒ Ä°ptal
                </button>
            </div>
        </div>
    `;
    
    document.body.appendChild(modal);
}

// FotoÄŸraf Ã¶nizleme fonksiyonu
function previewPhoto(input) {
    const file = input.files[0];
    if (file) {
        // Dosya boyutu kontrolÃ¼ (2MB)
        if (file.size > 2 * 1024 * 1024) {
            alert('Dosya boyutu 2MB\'dan bÃ¼yÃ¼k olamaz!');
            input.value = '';
            return;
        }
        
        // Dosya tÃ¼rÃ¼ kontrolÃ¼
        if (!file.type.startsWith('image/')) {
            alert('LÃ¼tfen geÃ§erli bir resim dosyasÄ± seÃ§in!');
            input.value = '';
            return;
        }
        
        const reader = new FileReader();
        reader.onload = function(e) {
            const avatarPreview = document.getElementById('avatarPreview');
            avatarPreview.innerHTML = `<img src="${e.target.result}" alt="Profil" class="w-full h-full object-cover">`;
            avatarPreview.className = 'w-16 h-16 rounded-full overflow-hidden';
        };
        reader.readAsDataURL(file);
    }
}

// Ekip Ã¼yesi kaydetme fonksiyonu
function saveTeamMember(role) {
    // Form verilerini al
    const name = document.getElementById('nameInput').value.trim();
    const email = document.getElementById('emailInput').value.trim();
    const phone = document.getElementById('phoneInput').value.trim();
    const extension = document.getElementById('extensionInput').value.trim();
    const department = document.getElementById('departmentInput').value.trim();
    const photoInput = document.getElementById('photoInput');
    
    // Validasyon
    if (!name || !email || !phone || !department) {
        showNotification('LÃ¼tfen tÃ¼m alanlarÄ± doldurun!', 'error');
        return;
    }
    
    if (!email.includes('@')) {
        showNotification('GeÃ§erli bir e-posta adresi girin!', 'error');
        return;
    }
    
    // FotoÄŸraf iÅŸleme
    let photoData = null;
    if (photoInput.files[0]) {
        const file = photoInput.files[0];
        const reader = new FileReader();
        reader.onload = function(e) {
            photoData = e.target.result;
            
            // LocalStorage'a kaydet
            const memberData = {
                name: name,
                email: email,
                phone: phone,
                extension: extension,
                department: department,
                photo: photoData,
                updatedAt: new Date().toISOString()
            };
            
            localStorage.setItem(`teamMember_${role}`, JSON.stringify(memberData));
            
            // KartÄ± gÃ¼ncelle
            updateTeamMemberCard(role, memberData);
            
            showNotification(`${role.charAt(0).toUpperCase() + role.slice(1)} bilgileri kaydedildi!`, 'success');
            
            // Modal'Ä± kapat
            document.querySelector('.fixed').remove();
        };
        reader.readAsDataURL(file);
    } else {
        // FotoÄŸraf yoksa sadece diÄŸer bilgileri kaydet
        const memberData = {
            name: name,
            email: email,
            phone: phone,
            extension: extension,
            department: department,
            photo: null,
            updatedAt: new Date().toISOString()
        };
        
        localStorage.setItem(`teamMember_${role}`, JSON.stringify(memberData));
        
        // KartÄ± gÃ¼ncelle
        updateTeamMemberCard(role, memberData);
        
        showNotification(`${role.charAt(0).toUpperCase() + role.slice(1)} bilgileri kaydedildi!`, 'success');
        
        // Modal'Ä± kapat
        document.querySelector('.fixed').remove();
    }
}

// Ekip Ã¼yesi kartÄ±nÄ± gÃ¼ncelleme fonksiyonu
function updateTeamMemberCard(role, memberData) {
    const card = document.querySelector(`[data-role="${role}"]`);
    if (card) {
        // Avatar gÃ¼ncelle
        const avatarDiv = card.querySelector('.w-12.h-12');
        if (memberData.photo) {
            avatarDiv.innerHTML = `<img src="${memberData.photo}" alt="${memberData.name}" class="w-10 h-10 rounded-full object-cover">`;
        } else {
            // VarsayÄ±lan avatar'Ä± geri yÃ¼kle
            const defaultAvatars = {
                'yonetici': 'ğŸ‘”',
                'yazilim': 'ğŸ’»',
                'destek': 'ğŸ”§',
                'ekp': 'ğŸ“‹'
            };
            avatarDiv.innerHTML = `<span class="text-2xl">${defaultAvatars[role]}</span>`;
        }
        
        // Ä°sim gÃ¼ncelle
        const nameElement = card.querySelector('h4');
        if (nameElement) nameElement.textContent = memberData.name;
        
        // Departman gÃ¼ncelle
        const deptElement = card.querySelector('p');
        if (deptElement) deptElement.textContent = memberData.department;
        
        // E-posta gÃ¼ncelle
        const emailElement = card.querySelector('.text-xs.text-gray-500 span');
        if (emailElement) emailElement.textContent = `ğŸ“§ ${memberData.email}`;
        
        // Telefon dahili gÃ¼ncelle
        const phoneElements = card.querySelectorAll('.text-xs.text-gray-500');
        if (phoneElements.length > 1) {
            const phoneElement = phoneElements[1].querySelector('span');
            if (phoneElement && memberData.extension) {
                phoneElement.textContent = `ğŸ“ ${memberData.phone} / ${memberData.extension}`;
            } else if (phoneElement) {
                phoneElement.textContent = `ğŸ“ ${memberData.phone}`;
            }
        }
    }
}

// Sayfa yÃ¼klendiÄŸinde kaydedilmiÅŸ verileri yÃ¼kle
document.addEventListener('DOMContentLoaded', function() {
    // KaydedilmiÅŸ ekip Ã¼yesi verilerini yÃ¼kle
    const roles = ['yonetici', 'yazilim', 'destek', 'ekp'];
    roles.forEach(role => {
        const savedData = localStorage.getItem(`teamMember_${role}`);
        if (savedData) {
            try {
                const memberData = JSON.parse(savedData);
                updateTeamMemberCard(role, memberData);
            } catch (e) {
                console.error('KaydedilmiÅŸ veri yÃ¼klenemedi:', e);
            }
        }
    });
    
    // Geri sayÄ±m timer'Ä± baÅŸlat
    initCountdownTimer();
});

// Bildirim gÃ¶sterme fonksiyonu
function showNotification(message, type = 'info') {
    const notification = document.createElement('div');
    notification.className = `fixed top-4 right-4 p-4 rounded-lg shadow-lg z-50 transform transition-all duration-300 translate-x-full`;
    
    const colors = {
        'success': 'bg-green-500 text-white',
        'error': 'bg-red-500 text-white',
        'warning': 'bg-yellow-500 text-white',
        'info': 'bg-blue-500 text-white'
    };
    
    notification.className += ` ${colors[type] || colors.info}`;
    notification.innerHTML = `
        <div class="flex items-center space-x-2">
            <span>${type === 'success' ? 'âœ…' : type === 'error' ? 'âŒ' : type === 'warning' ? 'âš ï¸' : 'â„¹ï¸'}</span>
            <span>${message}</span>
        </div>
    `;
    
    document.body.appendChild(notification);
    
    // Animasyon
    setTimeout(() => {
        notification.classList.remove('translate-x-full');
    }, 100);
    
    // Otomatik kaldÄ±r
    setTimeout(() => {
        notification.classList.add('translate-x-full');
        setTimeout(() => {
            notification.remove();
        }, 300);
    }, 3000);
}

// ======== GERÄ° SAYIM TÄ°MER FONKSÄ°YONLARI ========

// Geri sayÄ±m timer'Ä±nÄ± baÅŸlat
function initCountdownTimer() {
    // KaydedilmiÅŸ hedef tarihini yÃ¼kle
    const savedTargetDate = localStorage.getItem('projectTargetDate');
    if (savedTargetDate) {
        updateTargetDateDisplay(savedTargetDate);
        startCountdown(savedTargetDate);
    } else {
        // VarsayÄ±lan hedef tarih: 6 ay sonra
        const defaultDate = new Date();
        defaultDate.setMonth(defaultDate.getMonth() + 6);
        const defaultDateString = defaultDate.toISOString().split('T')[0];
        
        localStorage.setItem('projectTargetDate', defaultDateString);
        updateTargetDateDisplay(defaultDateString);
        startCountdown(defaultDateString);
    }
}

// Hedef tarih dÃ¼zenleme modalÄ±
function editTargetDate() {
    const currentTargetDate = localStorage.getItem('projectTargetDate') || '';
    
    const modal = document.createElement('div');
    modal.className = 'fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50';
    modal.innerHTML = `
        <div class="bg-white rounded-2xl p-6 max-w-md w-full mx-4 shadow-2xl">
            <div class="flex items-center justify-between mb-4">
                <h3 class="text-lg font-bold text-gray-800">ğŸ¯ Proje Hedef Tarihini Belirle</h3>
                <button onclick="this.closest('.fixed').remove()" class="text-gray-400 hover:text-gray-600 text-xl">
                    âœ•
                </button>
            </div>
            
            <div class="space-y-4">
                <div>
                    <label class="block text-sm font-medium text-gray-700 mb-2">ğŸ“… Hedef Tarih</label>
                    <input type="date" id="targetDateInput" value="${currentTargetDate}" 
                           class="w-full px-3 py-2 border border-gray-300 rounded-lg text-sm focus:border-blue-500 focus:ring-1 focus:ring-blue-500"
                           min="${new Date().toISOString().split('T')[0]}">
                    <p class="text-xs text-gray-500 mt-1">Projenin tamamlanmasÄ± hedeflenen tarih</p>
                </div>
                
                <div class="bg-blue-50 p-3 rounded-lg">
                    <p class="text-sm text-blue-700">
                        ğŸ“ <strong>Not:</strong> Bu tarih geri sayÄ±m timerÄ±nda kullanÄ±lacak ve yerel olarak saklanacaktÄ±r.
                    </p>
                </div>
            </div>
            
            <div class="flex gap-3 mt-6">
                <button onclick="saveTargetDate()" class="flex-1 bg-blue-600 hover:bg-blue-700 text-white py-2 px-4 rounded-lg font-medium transition-colors">
                    ğŸ’¾ Kaydet
                </button>
                <button onclick="this.closest('.fixed').remove()" class="flex-1 bg-gray-300 hover:bg-gray-400 text-gray-700 py-2 px-4 rounded-lg font-medium transition-colors">
                    âŒ Ä°ptal
                </button>
            </div>
        </div>
    `;
    
    document.body.appendChild(modal);
}

// Hedef tarihi kaydet
function saveTargetDate() {
    const targetDateInput = document.getElementById('targetDateInput');
    const targetDate = targetDateInput.value;
    
    if (!targetDate) {
        showNotification('LÃ¼tfen bir tarih seÃ§in!', 'error');
        return;
    }
    
    const selectedDate = new Date(targetDate);
    const today = new Date();
    
    if (selectedDate <= today) {
        showNotification('Hedef tarih bugÃ¼nden sonra olmalÄ±dÄ±r!', 'error');
        return;
    }
    
    // LocalStorage'a kaydet
    localStorage.setItem('projectTargetDate', targetDate);
    
    // GÃ¶rÃ¼ntÃ¼yÃ¼ gÃ¼ncelle
    updateTargetDateDisplay(targetDate);
    
    // Geri sayÄ±mÄ± yeniden baÅŸlat
    startCountdown(targetDate);
    
    // Modal'Ä± kapat
    document.querySelector('.fixed').remove();
    
    showNotification('Hedef tarih kaydedildi!', 'success');
}

// Hedef tarih gÃ¶rÃ¼ntÃ¼sÃ¼nÃ¼ gÃ¼ncelle
function updateTargetDateDisplay(targetDate) {
    const targetDateElement = document.getElementById('target-date-text');
    if (targetDateElement) {
        const date = new Date(targetDate);
        const options = { 
            year: 'numeric', 
            month: 'long', 
            day: 'numeric',
            weekday: 'long'
        };
        targetDateElement.textContent = date.toLocaleDateString('tr-TR', options);
    }
}

// Geri sayÄ±mÄ± baÅŸlat
function startCountdown(targetDate) {
    // Mevcut interval'Ä± temizle
    if (window.countdownInterval) {
        clearInterval(window.countdownInterval);
    }
    
    function updateCountdown() {
        const now = new Date().getTime();
        const target = new Date(targetDate).getTime();
        const difference = target - now;
        
        if (difference > 0) {
            // Zaman birimlerini hesapla
            const months = Math.floor(difference / (1000 * 60 * 60 * 24 * 30.44)); // Ortalama ay
            const days = Math.floor((difference % (1000 * 60 * 60 * 24 * 30.44)) / (1000 * 60 * 60 * 24));
            const hours = Math.floor((difference % (1000 * 60 * 60 * 24)) / (1000 * 60 * 60));
            const minutes = Math.floor((difference % (1000 * 60 * 60)) / (1000 * 60));
            const seconds = Math.floor((difference % (1000 * 60)) / 1000);
            
            // DOM elementlerini gÃ¼ncelle
            const monthsEl = document.getElementById('countdown-months');
            const daysEl = document.getElementById('countdown-days');
            const hoursEl = document.getElementById('countdown-hours');
            const minutesEl = document.getElementById('countdown-minutes');
            const secondsEl = document.getElementById('countdown-seconds');
            
            if (monthsEl) monthsEl.textContent = months;
            if (daysEl) daysEl.textContent = days;
            if (hoursEl) hoursEl.textContent = hours;
            if (minutesEl) minutesEl.textContent = minutes;
            if (secondsEl) secondsEl.textContent = seconds;
            
            // Renk deÄŸiÅŸtirme (sÃ¼re azaldÄ±kÃ§a kÄ±rmÄ±zÄ±ya dÃ¶nÃ¼r)
            const totalDays = Math.floor(difference / (1000 * 60 * 60 * 24));
            const timerElements = document.querySelectorAll('#countdown-timer .text-sm');
            
            timerElements.forEach(el => {
                el.className = 'text-sm font-bold ' + 
                    (totalDays < 30 ? 'text-red-600' : 
                     totalDays < 90 ? 'text-orange-600' : 
                     'text-orange-600');
            });
            
        } else {
            // SÃ¼re doldu
            const elements = ['countdown-months', 'countdown-days', 'countdown-hours', 'countdown-minutes', 'countdown-seconds'];
            elements.forEach(id => {
                const el = document.getElementById(id);
                if (el) {
                    el.textContent = '0';
                    el.className = 'text-sm font-bold text-red-600 animate-pulse';
                }
            });
            
            // SÃ¼re doldu bildirimini gÃ¶ster (sadece bir kez)
            if (!window.timeUpNotified) {
                showNotification('â° Proje hedef tarihi geldi!', 'warning');
                window.timeUpNotified = true;
            }
        }
    }
    
    // Ä°lk gÃ¼ncelleme
    updateCountdown();
    
    // Her saniye gÃ¼ncelle
    window.countdownInterval = setInterval(updateCountdown, 1000);
}
</script>
{% endblock %}
