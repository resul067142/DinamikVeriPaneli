{% extends 'base.html' %}

{% block title %}
    {% if is_edit %}Sütun Güncelle{% else %}Sütun Ekle{% endif %} - {{ app_name|default:"DVP" }}
{% endblock %}

{% block content %}
<div class="min-h-screen p-4">
    <div class="w-full">
        
        <!-- Test Veri Butonu -->
        {% if not is_edit %}
        <div class="text-center mb-6">
            <button type="button" onclick="generateFakeData()" 
                    class="px-4 py-2 bg-green-500 text-white rounded hover:bg-green-600">
                🎲 Test Verisi
            </button>
        </div>
        {% endif %}
        
        <!-- Form -->
        <form method="post" class="space-y-4">
            {% csrf_token %}
            
            <!-- Error Messages -->
            {% if form.errors %}
                <div class="bg-red-50 border border-red-200 rounded-lg p-4">
                    <div class="flex items-center gap-2 mb-2">
                        <span class="text-red-600">⚠️</span>
                        <h3 class="text-red-800 font-medium">Form hataları bulundu</h3>
                    </div>
                    <ul class="text-red-700 text-sm space-y-1">
                        {% for field, errors in form.errors.items %}
                            {% for error in errors %}
                                <li>• {{ error }}</li>
                            {% endfor %}
                        {% endfor %}
                    </ul>
                </div>
            {% endif %}

            <!-- Form Fields -->
            <div class="grid grid-cols-1 md:grid-cols-3 gap-6">
                <!-- Sütun Adı -->
                <div class="md:col-span-3">
                    <label class="block text-sm font-medium text-gray-700 mb-1">
                        📝 Sütun Adı
                        <span class="text-red-500">*</span>
                    </label>
                    <input type="text" 
                           name="ad" 
                           value="{{ form.ad.value|default:'' }}"
                           class="w-full px-3 py-2 border border-gray-300 rounded focus:ring-1 focus:ring-blue-500"
                           placeholder="İl Adı, Bölge, Nüfus..."
                           required>
                    {% if form.ad.errors %}
                        <div class="mt-1 text-xs text-red-600">{{ form.ad.errors.0 }}</div>
                    {% endif %}
                </div>
                
                <!-- Sütun Tipi -->
                <div>
                    <label class="block text-sm font-medium text-gray-700 mb-1">
                        🏷️ Sütun Tipi
                    </label>
                    <select name="tip" 
                            class="w-full px-3 py-2 border border-gray-300 rounded focus:ring-1 focus:ring-blue-500">
                        <option value="dinamik" {% if form.tip.value == 'dinamik' %}selected{% endif %}>Dinamik Sütun</option>
                        <option value="kurulacak" {% if form.tip.value == 'kurulacak' %}selected{% endif %}>Kurulacak Cihaz Sayısı</option>
                        <option value="kurulan" {% if form.tip.value == 'kurulan' %}selected{% endif %}>Kurulan Cihaz Sayısı</option>
                        <option value="arizali" {% if form.tip.value == 'arizali' %}selected{% endif %}>Arızalı Cihaz Sayısı</option>
                        <option value="tamamlanma" {% if form.tip.value == 'tamamlanma' %}selected{% endif %}>Tamamlanma Durumu</option>
                    </select>
                    {% if form.tip.errors %}
                        <div class="mt-1 text-xs text-red-600">{{ form.tip.errors.0 }}</div>
                    {% endif %}
                </div>
                
                <!-- Menü Tipi -->
                <div>
                    <label class="block text-sm font-medium text-gray-700 mb-1">
                        📱 Menü Tipi
                    </label>
                    <select name="menu_tipi" 
                            class="w-full px-3 py-2 border border-gray-300 rounded focus:ring-1 focus:ring-blue-500">
                        <option value="genel" {% if form.menu_tipi.value == 'genel' %}selected{% endif %}>Genel (Tüm Menüler)</option>
                        <option value="veri_listesi" {% if form.menu_tipi.value == 'veri_listesi' %}selected{% endif %}>Veri Listesi</option>
                        <option value="cihaz_turleri" {% if form.menu_tipi.value == 'cihaz_turleri' %}selected{% endif %}>Cihaz Türleri</option>
                    </select>
                    {% if form.menu_tipi.errors %}
                        <div class="mt-1 text-xs text-red-600">{{ form.menu_tipi.errors.0 }}</div>
                    {% endif %}
                </div>
                
                <!-- Sıra -->
                <div>
                    <label class="block text-sm font-medium text-gray-700 mb-1">
                        🔢 Sıra
                    </label>
                    <input type="number" 
                           name="sıra" 
                           value="{{ form.sıra.value|default:'1' }}"
                           class="w-full px-3 py-2 border border-gray-300 rounded focus:ring-1 focus:ring-blue-500"
                           placeholder="0, 1, 2, 3..."
                           min="0"
                           step="1">
                    {% if form.sıra.errors %}
                        <div class="mt-1 text-xs text-red-600">{{ form.sıra.errors.0 }}</div>
                    {% endif %}
                </div>
                
                <!-- Genişlik -->
                <div>
                    <label class="block text-sm font-medium text-gray-700 mb-1">
                        📏 Genişlik
                    </label>
                    <input type="text" 
                           name="genislik" 
                           value="{{ form.genislik.value|default:'auto' }}"
                           class="w-full px-3 py-2 border border-gray-300 rounded focus:ring-1 focus:ring-blue-500"
                           placeholder="auto, 100px, 20%">
                    {% if form.genislik.errors %}
                        <div class="mt-1 text-xs text-red-600">{{ form.genislik.errors.0 }}</div>
                    {% endif %}
                </div>
                
                <!-- Hizalama -->
                <div>
                    <label class="block text-sm font-medium text-gray-700 mb-1">
                        ↔️ Hizalama
                    </label>
                    <select name="hizalama" 
                            class="w-full px-3 py-2 border border-gray-300 rounded focus:ring-1 focus:ring-blue-500">
                        <option value="left" {% if form.hizalama.value == 'left' %}selected{% endif %}>Sol</option>
                        <option value="center" {% if form.hizalama.value == 'center' %}selected{% endif %}>Orta</option>
                        <option value="right" {% if form.hizalama.value == 'right' %}selected{% endif %}>Sağ</option>
                    </select>
                    {% if form.hizalama.errors %}
                        <div class="mt-1 text-xs text-red-600">{{ form.hizalama.errors.0 }}</div>
                    {% endif %}
                </div>
            </div>
            
            <!-- Checkboxes -->
            <div class="grid grid-cols-1 md:grid-cols-3 gap-6 pt-4">
                <div class="flex items-center">
                    <input type="checkbox" 
                           name="aktif" 
                           id="aktif"
                           {% if form.aktif.value %}checked{% endif %}
                           class="w-4 h-4 text-blue-600 border-gray-300 rounded focus:ring-blue-500">
                    <label for="aktif" class="ml-2 text-sm text-gray-700">
                        ✅ Sütun Aktif
                    </label>
                </div>
                
                <div class="flex items-center">
                    <input type="checkbox" 
                           name="gorunur" 
                           id="gorunur"
                           {% if form.gorunur.value %}checked{% endif %}
                           class="w-4 h-4 text-blue-600 border-gray-300 rounded focus:ring-blue-500">
                    <label for="gorunur" class="ml-2 text-sm text-gray-700">
                        👁️ Sütun Görünür
                    </label>
                </div>
            </div>
            
            <!-- Info Text -->
            <div class="bg-blue-50 border border-blue-200 rounded-lg p-3">
                <p class="text-sm text-blue-800">
                    💡 <strong>Bilgi:</strong> Aktif olmayan sütunlar tabloda görünmez ve veri girişinde kullanılamaz.
                </p>
            </div>

            <!-- Action Buttons -->
            <div class="flex gap-3 pt-4">
                <button type="submit" 
                        class="flex-1 px-4 py-2 bg-blue-500 text-white rounded hover:bg-blue-600 transition-colors">
                    {% if is_edit %}💾 Güncelle{% else %}➕ Sütun Ekle{% endif %}
                </button>
                <a href="{% url 'veri_yonetimi:sutun_listesi' %}" 
                   class="px-4 py-2 border border-gray-300 text-gray-700 rounded hover:bg-gray-50 transition-colors">
                   ❌ İptal
                </a>
            </div>
        </form>
        
        <!-- Sütun Bilgileri (Sadece düzenleme modunda) -->
        {% if is_edit and sutun %}
        <div class="mt-8 bg-gray-50 rounded-lg p-6">
            <h3 class="text-lg font-semibold text-gray-800 mb-4">📋 Sütun Bilgileri</h3>
            <div class="grid grid-cols-1 md:grid-cols-4 gap-6 text-sm">
                <div>
                    <span class="font-medium text-gray-700">Oluşturulma Tarihi:</span>
                    <span class="text-gray-600 ml-2">{{ sutun.oluşturulma_tarihi|date:"d.m.Y H:i" }}</span>
                </div>
                <div>
                    <span class="font-medium text-gray-700">Sıra:</span>
                    <span class="text-gray-600 ml-2">{{ sutun.sıra }}</span>
                </div>
                <div>
                    <span class="font-medium text-gray-700">Tip:</span>
                    <span class="text-gray-600 ml-2">{{ sutun.get_tip_display }}</span>
                </div>
                <div>
                    <span class="font-medium text-gray-700">Menü:</span>
                    <span class="text-gray-600 ml-2">{{ sutun.get_menu_tipi_display }}</span>
                </div>
            </div>
        </div>
        {% endif %}
    </div>
</div>

<script>
function generateFakeData() {
    // Sütun adları listesi
    const sutunAdlari = ['İl Adı', 'Bölge', 'Nüfus', 'Yüzölçümü', 'İklim', 'Ekonomi', 'Turizm', 'Eğitim', 'Sağlık', 'Ulaşım'];
    const randomAd = sutunAdlari[Math.floor(Math.random() * sutunAdlari.length)];
    
    // Rastgele değerler
    const randomSira = Math.floor(Math.random() * 10) + 1;
    const randomGenislik = ['auto', '100px', '150px', '200px', '20%'][Math.floor(Math.random() * 5)];
    
    // Form alanlarını doldur
    document.querySelector('input[name="ad"]').value = randomAd;
    document.querySelector('input[name="sıra"]').value = randomSira;
    document.querySelector('input[name="genislik"]').value = randomGenislik;
    
    // Checkbox'ları işaretle
    document.querySelector('input[name="aktif"]').checked = true;
    document.querySelector('input[name="gorunur"]').checked = true;
    
    alert('🎲 Test verileri eklendi!');
}
</script>
{% endblock %}
